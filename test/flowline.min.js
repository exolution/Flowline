var Flowline=function(e,t){var n,r,s=[],l=0,i=0,o={},a={fail:function(e){r=e,2==i&&(i=0,this.reject.apply(this,n))},resolve:function(){if(s.length>l){var e,r=s[l++];r&&r.done!=t&&("function"==typeof r.done?(e=r.done.apply(r.bind||this,arguments),r.done._promise||this.resolve.call(this,e)):this.resolve.call(this,r.done))}else i=1,n=Array.prototype.slice.call(arguments)},resolveWith:function(e){if(s.length>l){var r,o=s[l++];if(o&&o.done!=t)if("function"==typeof o.done){var a=[this];Array.prototype.push.apply(a,arguments),r=o.done.apply(e||o.bind||this,a),o.done._promise||this.resolveWith.call(this,e,r)}else this.resolve.call(this,o.done)}else i=1,n=Array.prototype.slice.call(arguments)},reject:function(){if(s.length>l){var e=s[l++];e&&("function"==typeof e.fail?e.fail.apply(this,arguments):r!=t&&r.apply(this,arguments))}else r!=t?r.apply(this,arguments):(i=2,n=Array.prototype.slice.call(arguments))},resume:function(){l--,0>l&&(l=0),this.resolve.apply(this,arguments)},then:function(e,r,l){return"function"==typeof e?s.push({done:e,fail:r,bind:l}):s.push({done:e}),1==i&&(i=0,this.resolve.apply(this,n)),2==i&&r!=t&&(i=0,this.reject.apply(this,n)),this}},p=function(){var e=arguments.length;if(e>0){l=0,a.length=0;for(var t=0;arguments.length>t;t++)a.then(arguments[t]);a.resolve()}return a};return p.promise=function(){return arguments.callee.caller._promise=!0,a},p.resolve=function(){a.resolve.apply(a,arguments)},p.reject=function(){a.reject.apply(a,arguments)},p.resume=function(){a.resume.apply(a,arguments)},p.after=function(e){var t=arguments.callee.caller;s.splice(l,0,{done:e},{done:t}),a.resolve.apply(a,Array.prototype.slice.call(arguments,1))},p.reset=function(){l=s.length=0},p.set=function(e,t){o[e]=t},p.get=function(e){return o[e]},p}(window);